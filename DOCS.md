# سامانه مدیریت پایانه بار اشتهارد
## راهنمای کامل سیستم

---

## وضعیت پیاده‌سازی ۵۰ ویژگی (docs.txt)

| # | ویژگی | وضعیت |
|---|---|---|
| ۱ | دسترسی از هر دستگاه / موبایل | ✅ پیاده‌سازی شده |
| ۲ | مشاهده لیست بارهای سالن‌های اعلان بار | ✅ پیاده‌سازی شده |
| ۳ | کارتابل الکترونیکی / پیگیری بدون حضور | ⚠️ جزئی (داشبورد + وضعیت بار) |
| ۴ | سیستم جذب بار برای بارهای رسوبی | ❌ پیاده‌سازی نشده |
| ۵ | ثبت درخواست حمل بار | ✅ پیاده‌سازی شده |
| ۶ | پنل نظارت وضعیت سالن برای تولیدی و باربری | ⚠️ جزئی (فقط ادمین) |
| ۷ | پنل مدیریتی نظارت پایانه بر رانندگان و باربری‌ها | ✅ پیاده‌سازی شده |
| ۸ | صدور حواله الکترونیکی برای راننده | ✅ پیاده‌سازی شده |
| ۹ | اعلان بار در کلیه سالن‌های یک استان | ⚠️ جزئی (اعلان به سالن خاص) |
| ۱۰ | ثبت و ارسال بار توسط تولیدی به باربری | ✅ پیاده‌سازی شده |
| ۱۱ | بررسی و ارسال بار به سالن توسط باربری | ✅ پیاده‌سازی شده |
| ۱۲ | نظارت بر وضعیت سالن توسط تولیدی و باربری | ⚠️ جزئی |
| ۱۳ | ممیزی بارها قبل از ارسال به سالن | ❌ پیاده‌سازی نشده |
| ۱۴ | صدور نوبت برای رانندگان | ✅ پیاده‌سازی شده |
| ۱۵ | ارسال مجدد درخواست‌های حمل بار قبلی | ❌ پیاده‌سازی نشده |
| ۱۶ | مدیریت تردد ورود/خروج پایانه فیزیکی | ❌ پیاده‌سازی نشده |
| ۱۷ | ثبت پلاک از دوربین پلاک‌خوان | ❌ پیاده‌سازی نشده |
| ۱۸ | ثبت‌نام راننده بدون گوشی توسط باربری/مدیر + SMS | ✅ پیاده‌سازی شده |
| ۱۹ | توقف اعلان بار توسط باربری | ✅ پیاده‌سازی شده |
| ۲۰ | مشاهده بارها بر اساس استان مبدأ | ✅ پیاده‌سازی شده |
| ۲۱ | جذب بار دستی برای بارهای رسوبی | ❌ پیاده‌سازی نشده |
| ۲۲ | کنترل بار جذب‌شده یک پلاک توسط تولیدی | ❌ پیاده‌سازی نشده |
| ۲۳ | ارسال پیامک به باربری، راننده، صاحب بار | ✅ پیاده‌سازی شده |
| ۲۴ | مجوز فعالیت در سالن برای رانندگان | ❌ پیاده‌سازی نشده |
| ۲۵ | تعریف سالن‌ها و شیفت‌های مختلف | ✅ پیاده‌سازی شده |
| ۲۶ | کنترل مدت سفر ناوگان / جلوگیری از پیش‌نوبت | ❌ پیاده‌سازی نشده |
| ۲۷ | ورود درخواست حمل از طریق اکسل | ✅ پیاده‌سازی شده |
| ۲۸ | تعیین کرایه بار توسط باربری | ✅ پیاده‌سازی شده |
| ۲۹ | گزارشات آماری و تفصیلی | ✅ پیاده‌سازی شده |
| ۳۰ | سیستم تیکتینگ داخلی | ✅ پیاده‌سازی شده (backend) |
| ۳۱ | توزیع بار بین شرکت‌های باربری | ❌ پیاده‌سازی نشده |
| ۳۲ | تعریف انواع شرایط حمل | ❌ پیاده‌سازی نشده |
| ۳۳ | اتصال به اتوماسیون داخلی تولیدی‌ها | ❌ پیاده‌سازی نشده |
| ۳۴ | گزارشات تحلیلی پیشرفته | ⚠️ جزئی (گزارش پایه) |
| ۳۵ | بارگذاری فایل بارها توسط تولیدی | ✅ پیاده‌سازی شده |
| ۳۶ | مشاهده و جستجو در لیست حواله‌ها | ✅ پیاده‌سازی شده |
| ۳۷ | مشاهده و افزودن کاربر | ✅ پیاده‌سازی شده |
| ۳۸ | گزارش‌گیری از نوبت و بارها | ✅ پیاده‌سازی شده |
| ۳۹ | ناوگان ملکی و استیجاری | ✅ پیاده‌سازی شده |
| ۴۰ | دریافت بارها به صورت مکانیزه برای باربری | ✅ پیاده‌سازی شده |
| ۴۱ | مشاهده و جستجو در وضعیت سالن باربری | ⚠️ جزئی |
| ۴۲ | مشاهده و مدیریت توافقات باربری | ❌ پیاده‌سازی نشده |
| ۴۳ | تراکنش‌ها و کیف پول | ❌ پیاده‌سازی نشده |
| ۴۴ | افزودن پایانه و تعیین حوزه جغرافیایی | ✅ پیاده‌سازی شده |
| ۴۵ | اعطای حق دسترسی به کاربران | ✅ پیاده‌سازی شده (نقش‌ها) |
| ۴۶ | مشاهده و جستجو در لیست بارهای باربری | ✅ پیاده‌سازی شده |
| ۴۷ | مشاهده، جستجو و افزودن راننده | ✅ پیاده‌سازی شده |
| ۴۸ | مشاهده، جستجو و افزودن ناوگان | ✅ پیاده‌سازی شده |
| ۴۹ | مشاهده، جستجو و افزودن نوبت | ✅ پیاده‌سازی شده |
| ۵۰ | مشاهده، جستجو و افزودن سالن | ✅ پیاده‌سازی شده |

### خلاصه

| وضعیت | تعداد |
|---|---|
| ✅ پیاده‌سازی شده | ۳۱ |
| ⚠️ جزئی / ناقص | ۶ |
| ❌ پیاده‌سازی نشده | ۱۳ |

### ویژگی‌های پیاده‌سازی نشده (اولویت‌بندی)
**اولویت بالا:**
- ۱۳ — ممیزی بارها قبل از سالن
- ۱۵ — ارسال مجدد درخواست قبلی
- ۲۴ — مجوز فعالیت در سالن برای راننده
- ۴۳ — کیف پول و تراکنش‌ها

**اولویت متوسط:**
- ۴، ۲۱ — جذب بار رسوبی
- ۲۶ — کنترل مدت سفر ناوگان
- ۳۱ — توزیع بار بین باربری‌ها
- ۴۲ — توافقات باربری

**اولویت پایین / سخت‌افزاری:**
- ۱۶ — تردد پایانه فیزیکی
- ۱۷ — دوربین پلاک‌خوان
- ۳۳ — اتصال به اتوماسیون داخلی

---

## ۱. معرفی سیستم

سامانه مدیریت پایانه بار اشتهارد یک نرم‌افزار تحت وب برای مدیریت عملیات پایانه باری است.
این سیستم فرآیند ثبت بار، اعلان به سالن، صدور نوبت و حمل‌ونقل را به صورت دیجیتال مدیریت می‌کند.

---

## ۲. نقش‌های کاربری

| نقش | نام فارسی | دسترسی‌ها |
|---|---|---|
| `TERMINAL_ADMIN` | مدیر پایانه | مدیریت کامل سیستم، کاربران، سالن‌ها، گزارشات |
| `FREIGHT_COMPANY` | شرکت باربری | پذیرش بار، اعلان سالن، صدور نوبت، مدیریت رانندگان |
| `PRODUCER` | تولیدکننده/ارسال‌کننده | ثبت بار، پیگیری وضعیت |
| `DRIVER` | راننده | مشاهده بارها، مدیریت نوبت‌ها |

---

## ۳. ورود به سیستم

### روش ورود (OTP)
1. شماره موبایل را وارد کنید
2. کد تأیید **123456** را وارد کنید
3. وارد پنل مربوط به نقش خود می‌شوید

### ثبت‌نام کاربر جدید
- اگر شماره موبایل در سیستم نباشد، حساب با وضعیت **در انتظار تأیید** ایجاد می‌شود
- مدیر پایانه باید حساب را تأیید کند
- پس از تأیید، کاربر می‌تواند وارد شود

### حساب‌های آزمایشی

| شماره | نقش | OTP |
|---|---|---|
| `09120644653` | مدیر پایانه | 123456 |
| `09111111111` | شرکت باربری | 123456 |
| `09222222222` | تولیدکننده | 123456 |
| `09333333333` | راننده | 123456 |

---

## ۴. گردش کار بار (Cargo Workflow)

### مراحل وضعیت بار

```
DRAFT → SUBMITTED → ACCEPTED_BY_FREIGHT → ANNOUNCED_TO_HALL → DRIVER_ASSIGNED → IN_TRANSIT → DELIVERED

                                        (در هر مرحله امکان CANCELLED وجود دارد)
```

### شرح مراحل

#### مرحله ۱ — تولیدکننده: ثبت بار
- وارد بخش **ثبت بار جدید** شوید
- فرم را پر کنید: استان/شهر مبدأ، استان/شهر مقصد، نوع بار، وزن
- بار با وضعیت `DRAFT` ذخیره می‌شود
- دکمه **ارسال** → وضعیت به `SUBMITTED` تغییر می‌کند

#### مرحله ۲ — شرکت باربری: پذیرش بار
- در بخش **درخواست‌های بار** بارهای `SUBMITTED` نمایش داده می‌شوند
- باربری بار را بررسی و **قبول** می‌کند → وضعیت: `ACCEPTED_BY_FREIGHT`
- باربری **کرایه** را تعیین می‌کند

#### مرحله ۳ — شرکت باربری: اعلان به سالن
- در بخش **اعلان به سالن** بار را به یک سالن پایانه اعلان می‌دهد
- وضعیت → `ANNOUNCED_TO_HALL`
- رانندگان این بار را در لیست خود می‌بینند

#### مرحله ۴ — شرکت باربری: صدور نوبت
- باربری راننده مناسب را انتخاب می‌کند
- تاریخ نوبت را تعیین می‌کند
- نوبت صادر می‌شود → وضعیت: `DRIVER_ASSIGNED`
- **حواله (Waybill)** به صورت خودکار صادر می‌شود
- پیامک تأیید نوبت برای راننده ارسال می‌شود

#### مرحله ۵ — راننده: حمل و تحویل
- راننده نوبت را در بخش **نوبت‌های من** می‌بیند
- حمل شروع می‌شود → وضعیت: `IN_TRANSIT`
- تحویل انجام می‌شود → وضعیت: `DELIVERED`

---

## ۵. پنل مدیر پایانه

### مدیریت کاربران (`/terminal/users`)
- مشاهده تمام کاربران ثبت‌شده
- **تأیید** کاربران در انتظار (وضعیت: در انتظار تأیید → تأیید شده)
- **مسدود کردن** کاربران
- **افزودن کاربر جدید** (مستقیم توسط مدیر)

### وضعیت کاربران

| وضعیت | رنگ | توضیح |
|---|---|---|
| در انتظار تأیید | نارنجی | ثبت‌نام کرده، منتظر تأیید مدیر |
| تأیید شده | سبز | می‌تواند وارد شود |
| مسدود | قرمز | دسترسی مسدود است |

### پایش رانندگان (`/terminal/drivers`)
- مشاهده تمام رانندگان و وضعیت تأییدیه آن‌ها
- اطلاعات باربری مرتبط با هر راننده

### پایش باربری‌ها (`/terminal/freight`)
- مشاهده تمام شرکت‌های باربری فعال

### مدیریت سالن‌ها (`/terminal/halls`)
- ایجاد و ویرایش سالن‌های پایانه
- تعیین ظرفیت و شیفت هر سالن

### گزارشات (`/terminal/reports`)
- آمار کلی بارها بر اساس وضعیت
- عملکرد رانندگان
- فعالیت سالن‌ها

---

## ۶. پنل شرکت باربری

| بخش | توضیح |
|---|---|
| درخواست‌های بار | بارهای ارسال‌شده از تولیدکنندگان |
| اعلان به سالن | اعلان بار پذیرفته‌شده به سالن |
| صدور نوبت | تخصیص راننده به بار |
| رانندگان | مدیریت لیست رانندگان |
| ناوگان | مدیریت خودروها |
| حواله‌ها | مشاهده و چاپ حواله‌های صادرشده |
| گزارشات | آمار و عملکرد |

---

## ۷. پنل تولیدکننده

| بخش | توضیح |
|---|---|
| ثبت بار جدید | فرم ثبت بار جدید |
| بارهای من | لیست و پیگیری وضعیت بارها |
| آپلود اکسل | ثبت انبوه بار از فایل اکسل |

### فرمت فایل اکسل برای آپلود انبوه
ستون‌های الزامی:
- `مبدأ استان`
- `مبدأ شهر`
- `مقصد استان`
- `مقصد شهر`
- `نوع بار`
- `وزن`

---

## ۸. پنل راننده

| بخش | توضیح |
|---|---|
| لیست بارها | بارهای موجود قابل تحویل بر اساس استان |
| نوبت‌های من | نوبت‌های صادرشده و حواله‌ها |

---

## ۹. اطلاعات فنی

### Stack فناوری
| لایه | فناوری |
|---|---|
| Frontend | React + Vite + TypeScript + MUI v5 |
| Backend | Node.js + Express + TypeScript |
| Database | PostgreSQL 16 |
| ORM | Prisma 5 |
| Auth | JWT (access 15min + refresh 7 روز) + OTP |

### اجرای سیستم

**Backend:**
```bash
cd backend
node .\node_modules\ts-node-dev\lib\bin.js --respawn --transpile-only src/index.ts
```

**Frontend:**
```bash
cd frontend
npx vite
```

### آدرس‌ها
- **Frontend:** http://127.0.0.1:3000
- **Backend API:** http://127.0.0.1:4000/api/v1
- **Health Check:** http://127.0.0.1:4000/api/v1/health

---

## ۱۰. نکات مهم

- کد OTP در حالت توسعه همیشه **123456** است
- مدیر پایانه از محدودیت تعداد درخواست OTP معاف است
- refreshToken در کوکی httpOnly ذخیره می‌شود (امنیت بالا)
- رابط کاربری کاملاً فارسی و راست‌به‌چپ (RTL) است
- تمام تاریخ‌ها به شمسی نمایش داده می‌شوند
